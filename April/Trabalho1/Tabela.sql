/* T1_Humberto_Correa_Logico: */

CREATE TABLE Carro (
    Codigo INT PRIMARY KEY,
    Placa VARCHAR,
    Marca VARCHAR,
    Modelo VARCHAR,
    Ano INT,
    Nome_Motorista VARCHAR
);

CREATE TABLE Passageiro (
    CPF VARCHAR PRIMARY KEY,
    Nome VARCHAR,
    Email VARCHAR,
    Telefone NUMERIC,
    Bairro VARCHAR,
    Meio_Pagamento VARCHAR,
    fk_Seguro_SeguroID INT
);

CREATE TABLE Viagem (
    Id INT PRIMARY KEY,
    Kms DOUBLE,
    Valor DOUBLE,
    Bairro_Partida VARCHAR,
    Taxa_Adicional DOUBLE,
    Cidade_Destino VARCHAR,
    Viagem_TIPO INT,
    fk_Carro_Codigo INT
);

CREATE TABLE Seguro (
    SeguroID INT PRIMARY KEY,
    Preco DOUBLE,
    Nome_Seguro VARCHAR,
    Beneficios VAR
);

CREATE TABLE Usa (
    fk_Viagem_Id INT,
    fk_Passageiro_CPF VARCHAR,
    fk_Seguro_SeguroID INT
);
 
ALTER TABLE Passageiro ADD CONSTRAINT FK_Passageiro_2
    FOREIGN KEY (fk_Seguro_SeguroID)
    REFERENCES Seguro (SeguroID)
    ON DELETE CASCADE;
 
ALTER TABLE Viagem ADD CONSTRAINT FK_Viagem_2
    FOREIGN KEY (fk_Carro_Codigo)
    REFERENCES Carro (Codigo)
    ON DELETE CASCADE;
 
ALTER TABLE Usa ADD CONSTRAINT FK_Usa_1
    FOREIGN KEY (fk_Viagem_Id)
    REFERENCES Viagem (Id)
    ON DELETE NO ACTION;
 
ALTER TABLE Usa ADD CONSTRAINT FK_Usa_2
    FOREIGN KEY (fk_Passageiro_CPF)
    REFERENCES Passageiro (CPF)
    ON DELETE NO ACTION;
 
ALTER TABLE Usa ADD CONSTRAINT FK_Usa_3
    FOREIGN KEY (fk_Seguro_SeguroID)
    REFERENCES Seguro (SeguroID)
    ON DELETE SET NULL;

    -- Garantindo integridade de identidade, domínio e referencial
-- Restrições de identidade
ALTER TABLE Carro MODIFY Codigo GENERATED BY DEFAULT ON NULL AS IDENTITY;

-- Restrições de domínio
ALTER TABLE Carro ADD CONSTRAINT CHK_Ano CHECK (Ano > 1900);

-- Restrições de referencial
ALTER TABLE Viagem ADD CONSTRAINT FK_Viagem_1
    FOREIGN KEY (fk_Carro_Codigo)
    REFERENCES Carro (Codigo)
    ON DELETE CASCADE;

ALTER TABLE Usa ADD CONSTRAINT FK_Usa_4
    FOREIGN KEY (fk_Viagem_Id, fk_Passageiro_CPF)
    REFERENCES Usa (fk_Viagem_Id, fk_Passageiro_CPF)
    ON DELETE CASCADE;

-- Dados de instâncias de objetos/registros
-- Carros
INSERT INTO Carro (Codigo, Placa, Marca, Modelo, Ano, Nome_Motorista)
VALUES
    (1, 'ABC1234', 'Toyota', 'Corolla', 2018, 'João da Silva'),
    (2, 'DEF5678', 'Honda', 'Civic', 2019, 'Maria Oliveira'),
    (3, 'GHI9101', 'Volkswagen', 'Gol', 2020, 'Pedro Santos');

-- Passageiros
INSERT INTO Passageiro (CPF, Nome, Email, Telefone, Bairro, Meio_Pagamento, fk_Seguro_SeguroID)
VALUES
    ('12345678901', 'José Souza', 'jose@example.com', 123456789, 'Centro', 'Cartão de Crédito', 1),
    ('23456789012', 'Ana Lima', 'ana@example.com', 234567890, 'Barra da Tijuca', 'Dinheiro', 2),
    ('34567890123', 'Carlos Silva', 'carlos@example.com', 345678901, 'Copacabana', 'Pix', 3),
    ('45678901234', 'Mariana Costa', 'mariana@example.com', 456789012, 'Ipanema', 'Cartão de Débito', 1),
    ('56789012345', 'Fernanda Oliveira', 'fernanda@example.com', 567890123, 'Leblon', 'Boleto Bancário', 2);

-- Viagens
INSERT INTO Viagem (Id, Kms, Valor, Bairro_Partida, Taxa_Adicional, Cidade_Destino, Viagem_TIPO, fk_Carro_Codigo)
VALUES
    (1, 20.5, 50.00, 'Centro', 5.00, 'Barra da Tijuca', 1, 1),
    (2, 15.2, 40.00, 'Copacabana', 3.00, 'Ipanema', 2, 2),
    (3, 30.0, 70.00, 'Leblon', 7.00, 'Centro', 1, 3),
    (4, 25.7, 60.00, 'Barra da Tijuca', 6.00, 'Copacabana', 2, 1),
    (5, 18.3, 45.00, 'Ipanema', 4.00, 'Leblon', 1, 2),
    (6, 35.1, 80.00, 'Centro', 8.00, 'Barra da Tijuca', 2, 3),
    (7, 22.0, 55.00, 'Copacabana', 5.00, 'Ipanema', 1, 1),
    (8, 28.6, 65.00, 'Leblon', 7.00, 'Centro', 2, 2),
    (9, 19.8, 50.00, 'Barra da Tijuca', 4.00, 'Copacabana', 1, 3),
    (10, 16.5, 40.00, 'Ipanema', 3.00, 'Leblon', 2, 1);

-- Seguros
INSERT INTO Seguro (SeguroID, Preco, Nome_Seguro, Beneficios)
VALUES
    (1, 50.00, 'Seguro Completo', 'Cobertura total em caso de acidente'),
    (2, 30.00, 'Seguro Básico', 'Cobertura parcial em caso de acidente'),
    (3, 40.00, 'Seguro VIP', 'Atendimento prioritário e assistência 24 horas');
